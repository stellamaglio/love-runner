<!-- Full code remains, below is appended enemy logic -->

<canvas id="gameCanvas" width="800" height="400" style="background:#87CEEB"></canvas>
<div id="joystick" style="position:absolute; bottom:30px; left:30px; width:80px; height:80px; border-radius:50%; background:rgba(255,255,255,0.2); border:2px solid white;"></div>
<div id="gameOverScreen" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); color:white; text-align:center; font-family:sans-serif;">
  <img id="cryingGirl" src="assets/ui/girl_crying_1.png" style="margin-top:50px; width:100px; height:auto;">
  <h1 style="margin:20px 0 10px 0;">Game Over</h1>
  <button onclick="restartGame()" style="padding:10px 20px; margin:10px; font-size:18px;">Rigioca</button>
  <button onclick="goToMenu()" style="padding:10px 20px; margin:10px; font-size:18px;">Torna al menu</button>
</div>

<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  const gameOverScreen = document.getElementById("gameOverScreen");
  const cryingGirl = document.getElementById("cryingGirl");

  let isGameOver = false;
  let cryingFrame = 0;
  const cryingFrames = [
    "assets/ui/girl_crying_1.png",
    "assets/ui/girl_crying_2.png",
    "assets/ui/girl_crying_3.png"
  ];

  function startCryingAnimation() {
    cryingFrame = 0;
    setInterval(() => {
      cryingGirl.src = cryingFrames[cryingFrame % cryingFrames.length];
      cryingFrame++;
    }, 500);
  }

  function triggerGameOver() {
    isGameOver = true;
    gameOverScreen.style.display = "block";
    startCryingAnimation();
  }

  function restartGame() {
    isGameOver = false;
    gameOverScreen.style.display = "none";
    cryingGirl.src = cryingFrames[0];
    // reset player, score, etc.
    // ...
  }

  function goToMenu() {
    window.location.href = "menu.html";
  }

  const obstacleImagePaths = {
    Tram: "assets/obstacles/tram.png",
    "Parliament Tower": "assets/obstacles/parliament_tower.png",
    "Lamp Post": "assets/obstacles/lamp_post.png",
    Moto: "assets/obstacles/moto.png",
    "Tram 28": "assets/obstacles/tram28.png",
    "Azulejo House": "assets/obstacles/azulejo_house.png",
    Dome: "assets/obstacles/dome.png",
    "Crescent Column": "assets/obstacles/crescent_column.png",
    "Turkish Cat": "assets/obstacles/turkish_cat.png",
    Snowbank: "assets/obstacles/snowbank.png",
    Aurora: "assets/obstacles/aurora.png",
    "Pine Tree": "assets/obstacles/pine_tree.png",
    Skis: "assets/obstacles/skis.png",
    "Snow Rock": "assets/obstacles/snow_rock.png",
    Lift: "assets/obstacles/lift.png",
    Eiffel: "assets/obstacles/eiffel.png",
    "Baguette Table": "assets/obstacles/baguette_table.png",
    "Love Locks": "assets/obstacles/love_locks.png",
    "Big Ben": "assets/obstacles/big_ben.png",
    Taxi: "assets/obstacles/taxi.png",
    Umbrella: "assets/obstacles/umbrella.png",
    Liberty: "assets/obstacles/liberty.png",
    "Pizza Bench": "assets/obstacles/pizza_bench.png",
    "Yellow Cab": "assets/obstacles/yellow_cab.png",
    Lantern: "assets/obstacles/lantern.png",
    "Ramen Bowl": "assets/obstacles/ramen_bowl.png",
    "Koi Banner": "assets/obstacles/koi_banner.png",
    Sunflower: "assets/obstacles/sunflower.png",
    Farmhouse: "assets/obstacles/farmhouse.png",
    Wine: "assets/obstacles/wine.png",
    "Red House": "assets/obstacles/red_house.png",
    Sled: "assets/obstacles/sled.png",
    Herring: "assets/obstacles/herring.png",
    Bike: "assets/obstacles/bike.png",
    Nyhavn: "assets/obstacles/nyhavn.png",
    Waffle: "assets/obstacles/waffle.png"
  };

  const obstacleImages = {};
  for (let key in obstacleImagePaths) {
    const img = new Image();
    img.src = obstacleImagePaths[key];
    obstacleImages[key] = img;
  }

  const backgroundObstacles = {
    budapest: ["Tram", "Parliament Tower", "Lamp Post"],
    lisbon: ["Moto", "Tram 28", "Azulejo House"],
    istanbul: ["Dome", "Crescent Column", "Turkish Cat"],
    tromso: ["Snowbank", "Aurora", "Pine Tree"],
    mountain: ["Skis", "Snow Rock", "Lift"],
    paris: ["Eiffel", "Baguette Table", "Love Locks"],
    london: ["Big Ben", "Taxi", "Umbrella"],
    newyork: ["Liberty", "Pizza Bench", "Yellow Cab"],
    tokyo: ["Lantern", "Ramen Bowl", "Koi Banner"],
    toscana: ["Sunflower", "Farmhouse", "Wine"],
    svezia: ["Red House", "Sled", "Herring"],
    copenhagen: ["Bike", "Nyhavn", "Waffle"]
  };

  const decorativeObstacles = [];

  function generateObstaclesForBackground(bg) {
    const list = backgroundObstacles[bg] || [];
    decorativeObstacles.length = 0;
    for (let i = 0; i < list.length; i++) {
      decorativeObstacles.push({
        label: list[i],
        x: 400 + i * 200,
        y: 300,
        width: 40,
        height: 40
      });
    }
  }

  function drawObstacles(ctx) {
    decorativeObstacles.forEach(o => {
      const sprite = obstacleImages[o.label];
      if (sprite && sprite.complete) {
        ctx.drawImage(sprite, o.x, o.y, o.width, o.height);
      } else {
        ctx.fillStyle = "gray";
        ctx.fillRect(o.x, o.y, o.width, o.height);
      }
    });
  }
</script>
